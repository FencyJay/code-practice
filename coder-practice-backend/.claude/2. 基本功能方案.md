# 《程序员技术练兵场》后端开发任务执行计划（最小可行版）

## 项目概述

开发一个帮助程序员提高需求分析、方案设计能力和技术广度的在线闯关平台，后端提供最基础的用户、关卡、闯关 API。

## 开发目标

- 实现用户注册、登录、登出，基于 session 存储登录态
- 在需要用户身份的接口中，直接通过 `session.getAttribute("user")` 判断是否登录
- 实现关卡获取、答题提交、历史记录查询的核心功能

## 技术栈

- Spring Boot
- MyBatis Plus（CRUD + 分页）
- MySQL
- Session（Spring Boot 内置，不加额外依赖）

## 开发任务清单

### 1. 数据库表

✅ 已完成，SQL 在 `sql/V1__Create_database_tables.sql`

### 2. 实体类

- `User.java`
- `Level.java`
- `UserLevel.java`

> 👉 字段和数据库一一对应，MyBatis Plus 自动映射

### 3. 封装类

#### 统一响应
- `Result<T>`：统一响应（code、msg、data）

#### DTO
- `UserRegisterDTO`（用户名、密码、昵称）
- `UserLoginDTO`（用户名、密码）
- `SubmitAnswerDTO`（levelId、userOptions）
- 分页请求 DTO

### 4. Mapper 层

- `UserMapper`
- `LevelMapper`
- `UserLevelMapper`

> 继承 BaseMapper，支持 MyBatis Plus CRUD

### 5. Service 层

#### UserService
- `register(UserRegisterDTO dto)`：注册用户（用户名唯一校验，密码加密存储）
- `login(UserLoginDTO dto, HttpSession session)`：校验账号密码，成功则写入 `session.setAttribute("user", user)`
- `logout(HttpSession session)`：`session.invalidate()` 注销登录
- `getCurrentUser(HttpSession session)`：返回当前登录用户

#### LevelService
- `getLevelList(PageRequestDTO dto)`：分页查询关卡
- `getLevelByDifficulty(String difficulty)`：按难度查询关卡

#### UserLevelService
- `submitAnswer(Long userId, SubmitAnswerDTO dto)`：计算得分并存储
- `getUserHistory(Long userId)`：查询用户闯关历史

### 6. Controller 层

#### UserController
- `POST /api/user/register` - 注册
- `POST /api/user/login` - 登录（成功后存 session）
- `POST /api/user/logout` - 登出（清空 session）
- `GET /api/user/current` - 获取当前登录用户

#### LevelController
- `GET /api/level/list` - 获取关卡列表（无需登录）
- `GET /api/level/difficulty/{difficulty}` - 获取某个难度的关卡（需登录，Controller 内判断 `session.getAttribute("user")`）

#### UserLevelController
- `POST /api/user-level/submit` - 提交答案（需登录，判断 session）
- `GET /api/user-level/history` - 获取闯关历史（需登录，判断 session）

### 7. 登录态验证（简化版）

- 不使用拦截器
- 在用户服务中写一个方法，获取登录态，如果没有获取到则抛出未登录异常

> 逻辑最直观，符合最小可行性

## 开发顺序

1. 数据库配置 & 实体类
2. 封装类（Result、DTO）
3. Mapper 层（MyBatis Plus 基础 CRUD）
4. UserService（注册、登录、登出）
5. LevelService & UserLevelService
6. Controller 层（直接用 session 判断登录态）
7. 简单联调

## 项目结构

```
src/main/java/com/codebear/coderpracticebackend/
├── model/
│   ├── entity/
│   │   ├── User.java
│   │   ├── Level.java
│   │   └── UserLevel.java
│   └── dto/
│       ├── user/
│       │   ├── UserLoginDTO.java
│       │   └── UserRegisterDTO.java
│       └── level/
│           └── SubmitAnswerDTO.java
├── common/
│   └── Result.java
├── mapper/
│   ├── UserMapper.java
│   ├── LevelMapper.java
│   └── UserLevelMapper.java
├── service/
│   ├── UserService.java
│   ├── impl/UserServiceImpl.java
│   ├── LevelService.java
│   ├── impl/LevelServiceImpl.java
│   ├── UserLevelService.java
│   └── impl/UserLevelServiceImpl.java
└── controller/
    ├── UserController.java
    ├── LevelController.java
    └── UserLevelController.java
```