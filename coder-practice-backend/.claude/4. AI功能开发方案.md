# AI功能开发方案

## 项目概述

基于现有的"程序员技术练兵场"后端项目，使用LangChain4j框架集成AI能力，实现AI生成关卡和AI生成结果报告功能。

## 技术栈

- **AI框架**: LangChain4j 1.4.0-beta10
- **AI模型**: 阿里云DashScope
- **后端框架**: Spring Boot 3.5
- **数据库**: MySQL + MyBatis Plus

## 核心功能实现

### 1. LangChain4j集成配置

#### 1.1 依赖管理
在项目pom.xml中添加LangChain4j相关依赖，包括阿里云DashScope集成包和响应式处理包。

#### 1.2 应用配置
在application.yaml中配置LangChain4j相关参数，包括API密钥和模型名称，支持环境变量注入。

### 2. AI服务层设计

#### 2.1 提示词文件管理
创建独立的提示词文件目录结构，实现提示词与代码分离：
- `level-generation-prompt.txt`: 关卡生成系统提示词
- `result-report-prompt.txt`: 结果报告生成系统提示词
- `result-report-template.txt`: 结果报告用户消息模板

然后你应该利用 LangChain4j 的 AI Service + SystemMessage 注解加载提示词文件，不需要版本化管理、不需要保存数据库、不需要复杂的配置。  
  
举个例子：  
  
java  格式
interface Friend {  
  
    @SystemMessage(fromResource = "my-prompt-template.txt")  
    String chat(String userMessage);  
}  

#### 2.2 AI服务接口定义
基于LangChain4j的AI Service模式定义两个核心服务接口：
- **LevelGenerationService**: 负责根据用户薪资生成关卡内容
- **ResultReportService**: 负责根据用户答题情况生成评估报告

### 3. 业务服务层增强

#### 3.1 LevelService功能扩展
在现有LevelService基础上添加AI生成关卡能力：
- 接收用户薪资参数
- 调用AI服务生成关卡内容
- 解析AI响应并转换为Level实体
- 根据薪资范围动态确定难度等级
- 持久化生成的关卡数据

#### 3.2 UserLevelService功能扩展
在现有UserLevelService基础上添加AI结果报告生成能力：
- 获取用户答题记录和关卡信息
- 调用AI服务生成评估报告
- 解析AI响应并更新用户关卡记录
- 自动调整用户薪资水平
- 更新用户能力评估数据

### 4. 控制器层扩展

#### 4.1 LevelController接口增强
新增AI生成关卡相关接口：
- POST /api/level/generate: 根据薪资生成新关卡

#### 4.2 UserLevelController接口增强
新增AI结果报告相关接口：
- POST /api/user-level/generate-report: 生成答题结果报告
- 优化现有答题提交接口，支持AI评估

### 5. 配置管理

#### 5.1 LangChain4j配置类
创建专门的配置类管理AI服务：
- 配置AI模型连接参数
- 创建AI服务Bean实例
- 管理提示词资源加载

### 6. 工具类支持

#### 6.1 JSON解析工具
开发专门的JSON解析工具类：
- AI响应数据解析
- 数据格式验证
- 异常处理机制

## 实现步骤

1. **环境准备**: 添加LangChain4j依赖，配置应用参数
2. **提示词设计**: 创建和管理AI提示词文件
3. **AI服务开发**: 实现关卡生成和结果报告AI服务
4. **业务逻辑集成**: 在现有服务中集成AI能力
5. **API接口扩展**: 增强控制器提供AI功能接口
6. **配置管理**: 创建AI服务配置类
7. **工具支持**: 开发JSON解析等工具类

## 关键技术点

### 1. 提示词工程
- 系统提示词优化，确保AI输出质量
- 用户消息模板设计，支持动态参数注入
- 提示词版本管理，支持动态调整

### 2. 数据处理
- AI响应结构化解析
- 数据验证和异常处理
- 薪资动态调整算法


### 3. 安全保障
- API密钥安全管理
- 数据输入验证
- 错误信息脱敏
